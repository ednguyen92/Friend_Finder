<!DOCTYPE html>
<html>

<head>
	<title>Survey</title>
	<!-- Jquery CDN  -->
	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

	<!-- Bootstrap JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	    <!-- materialize -->
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
			<!-- materialize icons -->
			<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>

<body>

	<!-- <br><br><br><br> -->
	<!-- Questions -->
	<div class="container">
			<div class='card-panel blue accent-3 col s12 center-align'>
					<h4><strong>Survey Questions</strong></h4>
					<div class='card-panel left-align white'>
					<form name="myForm">
						<div class="input-group">
							<div>
								<input id="name" type="text" class="form-control" name="name">
								<label class='active' for="name">Name (required)</label>
							</div>
							<div>
								<input id="image" type="text" class="form-control" name="img">
								<label class='active' for="name">Photo of yourself (required)</label>
					</form>

					<!-- Question 1	 -->
					<h5><strong>Question 1</strong></h5>
					<p>I consider myself to be an introvert.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q1">
							<li value="1">
								<a href="#">1 (Strongly Disagree</a>
							</li>
							<li value="2">
								<a href="#">2</a>
							</li>
							<li value="3">
								<a href="#">3</a>
							</li>
							<li value="4">
								<a href="#">4</a>
							</li>
							<li value="5">
									<a href="#">5 (Strongly Agree)</a>
								</li>
						</ul>
					</div>
					<!-- End of question 1 -->

					<br>
					<br>
					<br>

					<!-- Question 2 -->
					<h5><strong>Question 2</strong></h5>
					<p>I consider myself to be an extrovert.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q2">
								<li value="1">
									<a href="#">1 (Strongly Disagree</a>
								</li>
								<li value="2">
									<a href="#">2</a>
								</li>
								<li value="3">
									<a href="#">3</a>
								</li>
								<li value="4">
									<a href="#">4</a>
								</li>
								<li value="5">
										<a href="#">5 (Strongly Agree)</a>
									</li>
							</ul>
					</div>
					<!-- End of question2 -->

					<br>
					<br>
					<br>

					<!-- Question 3 -->
					<h5><strong>Question 3</strong></h5>
					<p>I consider myself to be an organized person.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q3">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question3 -->
					<br>
					<br>
					<br>
					<!-- Question 4 -->
					<h5><strong>Question 4</strong></h5>
					<p>I consider myself to be an outdoors person.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q4">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question4 -->
					<br>
					<br>
					<br>
					<!-- Question 5 -->
					<h5><strong>Question 5</strong></h5>
					<p>I prefer to play video games rather then sports.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q5">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question3 -->
					<br>
					<br>
					<br>
					<!-- Question 6 -->
					<h5><strong>Question 6</strong></h5>
					<p>I consider myself to be open minded.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q6">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question6 -->
					<br>
					<br>
					<br>
					<!-- Question 7 -->
					<h5><strong>Question 7</strong></h5>
					<p>I am eager to gain new experiences.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q7">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question7 -->
					<br>
					<br>
					<br>
					<!-- Question 8 -->
					<h5><strong>Question 8</strong></h5>
					<p>I consider myself to be physically fit.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q8">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question8 -->
					<br>
					<br>
					<br>
					<!-- Question 9 -->
					<h5><strong>Question 9</strong></h5>
					<p>I prefer to have a small group of close friends over a large group of semi cloe friends.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q9">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="#">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question9 -->
					<br>
					<br>
					<br>
					<!-- Question 10 -->
					<h5><strong>Question 10</strong></h5>
					<p>I am excited to be using this app.</p>
					<div class="dropdown">
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							Select an Option
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu q10">
								<li value="1">
										<a href="#">1 (Strongly Disagree</a>
									</li>
									<li value="2">
										<a href="#">2</a>
									</li>
									<li value="3">
										<a href="#">3</a>
									</li>
									<li value="4">
										<a href="">4</a>
									</li>
									<li value="5">
											<a href="#">5 (Strongly Agree)</a>
										</li>
								</ul>
					</div>
					<!-- End of question10 -->
					<br>
				</div>
				<input class="submit waves-effect wave-light  btn light-green accent-3" type="submit" name="Submit">
			</div>
					</div>
					</div>
			</div>

			<!-- Modal -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">Meet your new Best Friend!</h4>
						</div>
						<div class="modal-body">
						</div>
						<div class="modal-footer">
							<button type="button" class="modal-action modal-close waves-effect waves-green btn-flat" data-dismiss="modal">Done</button>
						</div>
					</div>
				</div>
			</div>
			<!-- End of Modal -->

			<!-- Capturing users chooice -->
			<script type="text/javascript">
				$(document).ready(function () {
					var q1 = 0, q2 = 0, q3 = 0, q4 = 0, q5 = 0, q6 = 0,
						q7 = 0, q8 = 0, q9 = 0, q10 = 0;
					var userScore = [];
					//Replaces the default "Select option with users choice" 
					$(".dropdown-menu li a").on('click', function () {
						$(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
					});
					// gets question input value
					$('.q1 li').on('click', function () {
						q1 = $(this).val();
					});
					$('.q2 li').on('click', function () {
						q2 = $(this).val();
					});
					$('.q3 li').on('click', function () {
						q3 = $(this).val();
					});
					$('.q4 li').on('click', function () {
						q4 = $(this).val();
					});
					$('.q5 li').on('click', function () {
						q5 = $(this).val();
					});
					$('.q6 li').on('click', function () {
						q6 = $(this).val();
					});
					$('.q7 li').on('click', function () {
						q7 = $(this).val();
					});
					$('.q8 li').on('click', function () {
						q8 = $(this).val();
					});
					$('.q8 li').on('click', function () {
						q9 = $(this).val();
					});
					$('.q10 li').on('click', function () {
						q10 = $(this).val();
					});

					// When Submit button is clicked ......
					$('.submit').on('click', function (event) {
						event.preventDefault();
						// Validation
						var userScore = [q1, q2, q3, q4, q5, q6, q7, q8, q9, q10];
						const isName = document.forms["myForm"]["name"].value;
						const isImg = document.forms["myForm"]["img"].value;
						//Checks if name and image input are empty and if all questions are filled out
						if (isName == "" || isImg == "") {
							alert("All fields must be filled out");
						}
						else {
							// User input information
							var personData = {
								"name": $('#name').val().trim(),
								"photo": $('#image').val().trim(),
								"scores": [q1, q2, q3, q4, q5, q6,
									q7, q8, q9, q10]
							}
							// Posts users name, image & score
							$.post('/api/friend', personData, function (data) {
								//Clears out name and image input 
								$('#name').val("");
								$('#image').val("");
							});
							// Holds users score
							// Compares Scores
							scoreCompare(userScore);
						}
					});
					function scoreCompare(userScore) {
						const currentURL = window.location.origin;
						var scoreArr = [];
						var sum = 0;
						$.ajax(
							{
								url: currentURL + '/api/friend',
								method: 'GET'
							})
							.done(function (data) {
								var lowScore = 10;
								var index = 0;
								//First loop chooses the nth element in the array of people
								for (var i = 0; i < data.length - 1; i++) {
									//Subtracts both scores and adds it to sum variable
									for (var j = 0; j < userScore.length; j++) {
										sum += userScore[j] - data[i].scores[j];
									}
									// Push sum to score array then resets sum to 0
									scoreArr.push(Math.abs(sum));
									sum = 0;
								}
								//Get index of lowest number in the score arr 
								console.log(scoreArr);
								for (var i = 0; i < scoreArr.length; i++) {
									// Checks to see if the nth index of scoreArr is lower then the current low score
									if (scoreArr[i] < lowScore) {
										//Assign new low score
										lowScore = scoreArr[i];
										//Assign new index which is the current lowest score 
										index = i;
									}
								}
								modal(data, index);
								// Testing
								console.log('Low score', lowScore);
								console.log('index', index);
							});
					}
					function modal(data, index) {
						$('.modal-body').empty();
						var matchName = data[index].name;
						var matchImg = data[index].photo;
						//Modal
						$('#myModal').modal('show');
						console.log('image:', matchImg);
						console.log('name:', matchName);
						var nameDiv = $('<h3 style="color:black">');
						var imgDiv = $('<img style="width:300px">');
						nameDiv.text(matchName);
						imgDiv.attr('src', matchImg);
						$('.modal-body').append(nameDiv);
						$('.modal-body').append(imgDiv);
					}
				}); 
			</script>
</body>

</html>